{% extends "layout.html" %}
{% load user_extras %}
{% block title %}Comandas - Mesa {{ table.name }}{% endblock %}
{% block body %}
<main class="container">
  <h1>Comandas de Mesa {{ table.name }}</h1>

  {% if orders %}
    {% for order in orders %}
      <article>
          <h3>Comanda #{{ order.id }}</h3>
          <p>Mesero: {{ order.user.username }}</p>
          <p>Fecha: {{ order.created_at }}</p>
          <hr>
        <table>
          <tr>
            <th>Cantidad</th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Monto</th>
          </tr>
          {% for item in order.orderitem_set.all %}
            <tr>
              <td>{{ item.quantity }}</td>
              <td>{{ item.product.name }}</td>
              <td>{{ item.product.price}}</td>
              <td>C$ {{ item.get_total|floatformat:2 }}</td>
            </tr>
          {% endfor %}
          <tr>
            <th colspan="3">Total</th>
            <th>C$ {{ order.get_total|floatformat:2 }}</th>
          </tr>
        </table>
        {% if user|is_encargado %}
        <footer>
          <a href="{% url 'edit_order' order.id %}" role="button">✏️ Editar Comanda</a>
        </footer>
        {% endif %}
      </article>
    {% endfor %}
  {% else %}
    <p>No hay comandas pendientes para esta mesa.</p>
  {% endif %}
</main>
{% endblock %}
